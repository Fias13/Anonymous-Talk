<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Chatroom - Campfire (Firebase Realtime)</title>
<style>
body {
  margin: 0;
  padding: 0;
  background: #ECE4D4;
  font-family: 'Comic Sans MS', 'Arial Rounded MT Bold', sans-serif;
  overflow: hidden;
}
 
.scene {
  position: relative;
  width: 100vw;
  height: 100vh;
  overflow: hidden;
}
 
.cave {
  position: absolute;
  width: 50%;
  left: 22%;
  top: 35%;
  transform: translate(-50%, -50%);
  z-index: 1;
}
 
.fire {
  position: absolute;
  width: 30%;
  bottom: 20%;
  left: 40%;
  transform: translateX(-50%);
  z-index: 3;
  animation: fireWind 1.5s infinite ease-in-out;
  filter: brightness(1.05) saturate(1);
}
 
@keyframes fireWind {
  0%   { transform: translateX(-50%) translateX(0px) translateY(0px) rotate(0deg) scale(1); filter: brightness(1) saturate(1); }
  10%  { transform: translateX(-50%) translateX(-2px) translateY(-2px) rotate(-2deg) scale(1.02); filter: brightness(1.2) saturate(1.3); }
  25%  { transform: translateX(-50%) translateX(3px) translateY(-3px) rotate(3deg) scale(1.05); filter: brightness(1.3) saturate(1.4); }
  50%  { transform: translateX(-50%) translateX(-3px) translateY(2px) rotate(-3deg) scale(1); filter: brightness(0.9) saturate(0.9); }
  75%  { transform: translateX(-50%) translateX(2px) translateY(-1px) rotate(2deg) scale(1.03); filter: brightness(1.1) saturate(1.2); }
  100% { transform: translateX(-50%) translateX(0px) translateY(0px) rotate(0deg) scale(1); filter: brightness(1) saturate(1); }
}
 
#chairs img {
  position: absolute;
  width: 20%;
  z-index: 2;
  transform: translate(-98%, -60%);
}
 
.dino {
  position: absolute;
  width: 8%;
  z-index: 4;
  transform: translate(-50%, -90%);
  animation-name: sway;
  animation-timing-function: ease-in-out;
  animation-iteration-count: infinite;
  animation-direction: alternate;
}
 
@keyframes sway {
  0%   { transform: translate(-50%, -90%) translateY(0px) rotate(0deg); }
  25%  { transform: translate(-50%, -90%) translateY(-2px) rotate(-1deg); }
  50%  { transform: translate(-50%, -90%) translateY(1px) rotate(1deg); }
  75%  { transform: translate(-50%, -90%) translateY(-1px) rotate(2deg); }
  100% { transform: translate(-50%, -90%) translateY(0px) rotate(0deg); }
}
 
.chat-sidebar {
  position: fixed;
  right: 3%;
  top: 5%;
  width: 400px;
  height: 85%;
  background: rgba(255,255,255,0.97);
  border: 3px solid #333;
  border-radius: 15px;
  box-shadow: 6px 6px 0px #333;
  display: flex;
  flex-direction: column;
  padding: 25px 30px;
  z-index: 10;
}
 
.chat-sidebar h2 {
  text-align: center;
  margin-bottom: 15px;
  font-size: 22px;
}
 
.settings-btn {
  position: absolute;
  top: 20px;
  right: 20px;
  width: 32px;
  height: 32px;
  border: none;
  background: transparent;
  font-size: 20px;
  cursor: pointer;
  transition: transform 0.2s ease;
  padding: 0;
  display: flex;
  align-items: center;
  justify-content: center;
}
 
.settings-btn:hover {
  transform: rotate(45deg) scale(1.1);
}
 
.online-users {
  text-align: center;
  font-size: 14px;
  color: #27ae60;
  margin-bottom: 10px;
  font-weight: bold;
}
 
.chat-messages {
  flex: 1;
  overflow-y: auto;
  padding: 12px;
  border: 2px solid #333;
  border-radius: 10px;
  margin-bottom: 10px;
  background: #fdfdfd;
  font-size: 16px;
}
 
.chat-messages p {
  margin: 8px 0;
  padding: 8px;
  background: #f0f0f0;
  border-radius: 8px;
  word-wrap: break-word;
}
 
.chat-messages p .username {
  cursor: pointer;
  color: #2980b9;
  font-weight: bold;
  text-decoration: underline;
  transition: color 0.2s;
}
 
.chat-messages p .username:hover {
  color: #3498db;
}
 
.chat-messages p.system {
  background: #fff3cd;
  color: #856404;
  font-style: italic;
}
 
.chat-messages p.own-message {
  background: #d4edda;
  text-align: right;
}
 
.chat-messages p.own-message .username {
  cursor: default;
  text-decoration: none;
  color: inherit;
}
 
.chat-input {
  display: flex;
  gap: 8px;
}
 
.hamburger-btn {
  flex: none;
  width: 40px;
  height: 40px;
  border-radius: 10px;
  border: 2px solid #333;
  background: #fff;
  cursor: pointer;
  font-size: 18px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: 0.2s;
  padding: 0;
  margin: 0;
}
 
.hamburger-btn:hover {
  background: #333;
  color: #fff;
  transform: scale(1.05);
}
 
.hamburger-menu {
  position: absolute;
  bottom: 80px;
  left: 30px;
  background: #fff;
  border: 2px solid #333;
  border-radius: 12px;
  box-shadow: 4px 4px 0px #333;
  padding: 8px;
  display: none;
  flex-direction: column;
  gap: 4px;
  min-width: 160px;
  z-index: 20;
}
 
.hamburger-menu.show {
  display: flex;
  animation: slideUp 0.2s ease;
}
 
@keyframes slideUp {
  from {
    opacity: 0;
    transform: translateY(10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
 
.hamburger-menu .menu-item {
  padding: 10px 12px;
  border: none;
  border-radius: 8px;
  background: transparent;
  cursor: pointer;
  font-size: 14px;
  font-weight: 600;
  text-align: left;
  transition: background 0.2s ease;
  white-space: nowrap;
}
 
.hamburger-menu .menu-item:hover {
  background: #f0f0f0;
}
 
.chat-sidebar input {
  flex: 1;
  padding: 10px 12px;
  border-radius: 10px;
  border: 2px solid #333;
  font-size: 15px;
  box-sizing: border-box;
  height: 40px;
}
 
.chat-sidebar button#sendBtn {
  flex: none;
  padding: 10px 16px;
  height: 40px;
  border-radius: 10px;
  border: 2px solid #333;
  background: #fff;
  cursor: pointer;
  transition: 0.2s;
  font-size: 15px;
}
 
.chat-sidebar button#sendBtn:hover {
  transform: scale(1.05);
  background: #333;
  color: #fff;
}
 
.back-btn {
  position: fixed;
  top: 3%;
  left: 1%;
  z-index: 20;
  width: 60px;
  height: 60px;
  cursor: pointer;
  transition: transform 0.3s ease, filter 0.3s ease;
}
 
.back-btn:hover {
  transform: scale(1.1) rotate(-8deg);
  filter: brightness(1.2);
}
 
.music-control {
  position: fixed;
  bottom: 3%;
  left: 2%;
  z-index: 20;
  display: flex;
  flex-direction: row;
  align-items: center;
  gap: 15px;
}
 
.music-btn {
  width: 55px;
  height: 55px;
  border-radius: 50%;
  border: 3px solid #333;
  background: rgba(255, 255, 255, 0.95);
  box-shadow: 4px 4px 0px #333;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 26px;
  transition: all 0.3s ease;
  animation: float 3s ease-in-out infinite;
}
 
.music-btn:hover {
  transform: scale(1.15) rotate(5deg);
  box-shadow: 6px 6px 0px #333;
  background: rgba(255, 255, 255, 1);
}
 
.music-btn:active {
  transform: scale(1.05);
  box-shadow: 2px 2px 0px #333;
}
 
.music-btn.playing {
  background: linear-gradient(135deg, #d4edda 0%, #c3f7d4 100%);
  animation: float 3s ease-in-out infinite, pulse-glow 2s ease infinite;
}
 
.volume-control {
  display: none;
  flex-direction: row;
  align-items: center;
  gap: 12px;
  animation: slideIn 0.3s ease;
}
 
.volume-control.show {
  display: flex;
}
 
.volume-label {
  font-size: 20px;
  color: #333;
  min-width: 28px;
  text-align: center;
  filter: drop-shadow(2px 2px 2px rgba(0,0,0,0.3));
}
 
.volume-slider {
  -webkit-appearance: none;
  appearance: none;
  width: 140px;
  height: 10px;
  border-radius: 10px;
  background: linear-gradient(to right, #27ae60 0%, #27ae60 3%, rgba(255,255,255,0.7) 3%, rgba(255,255,255,0.7) 100%);
  outline: none;
  cursor: pointer;
  border: 2px solid #333;
  box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
}
 
.volume-slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 24px;
  height: 24px;
  border-radius: 50%;
  background: #fff;
  cursor: pointer;
  border: 3px solid #333;
  transition: all 0.2s ease;
  box-shadow: 0 2px 6px rgba(0,0,0,0.3);
}
 
.volume-slider::-webkit-slider-thumb:hover {
  transform: scale(1.2);
  background: #27ae60;
}
 
.volume-value {
  font-size: 18px;
  font-weight: bold;
  color: #fff;
  min-width: 50px;
  text-align: center;
  text-shadow: 2px 2px 4px rgba(0,0,0,0.5),
               -1px -1px 2px rgba(0,0,0,0.3);
}
 
@keyframes float {
  0%, 100% { transform: translateY(0px); }
  50% { transform: translateY(-8px); }
}
 
@keyframes pulse-glow {
  0%, 100% { box-shadow: 4px 4px 0px #333, 0 0 0px rgba(39, 174, 96, 0); }
  50% { box-shadow: 4px 4px 0px #333, 0 0 20px rgba(39, 174, 96, 0.6); }
}
 
@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-15px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}
 
.kick-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.7);
  backdrop-filter: blur(5px);
  z-index: 1000;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease;
}
 
.kick-modal.show {
  display: flex;
}
 
.kick-card {
  background: linear-gradient(135deg, #fff3cd 0%, #fffef0 100%);
  border: 4px solid #e74c3c;
  border-radius: 25px;
  padding: 50px 60px;
  text-align: center;
  box-shadow: 0 20px 60px rgba(0, 0, 0, 0.4);
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  max-width: 450px;
  width: 90%;
}
 
.kick-icon {
  font-size: 80px;
  margin-bottom: 20px;
  animation: shake 0.5s ease;
}
 
.kick-title {
  font-size: 32px;
  font-weight: 900;
  color: #e74c3c;
  margin-bottom: 15px;
}
 
.kick-message {
  font-size: 20px;
  color: #333;
  margin-bottom: 25px;
  line-height: 1.5;
}
 
.kick-countdown {
  font-size: 48px;
  font-weight: 900;
  color: #e74c3c;
  margin: 20px 0;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
  animation: pulse 1s ease infinite;
}
 
/* Profile Modal */
.profile-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(3px);
  z-index: 1001;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease;
}
 
.profile-modal.show {
  display: flex;
}
 
.profile-card {
  background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
  border: 3px solid #333;
  border-radius: 20px;
  padding: 35px 40px;
  text-align: center;
  box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  max-width: 400px;
  width: 90%;
  position: relative;
}
 
.profile-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: transparent;
  border: none;
  font-size: 28px;
  cursor: pointer;
  color: #666;
  transition: all 0.2s;
  width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}
 
.profile-close:hover {
  background: #f0f0f0;
  color: #333;
  transform: rotate(90deg);
}
 
.profile-avatar {
  width: 120px;
  height: 120px;
  border-radius: 50%;
  margin: 0 auto 20px;
  border: 4px solid #333;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  object-fit: cover;
  background: #f0f0f0;
}
 
.profile-username {
  font-size: 28px;
  font-weight: 900;
  color: #333;
  margin-bottom: 10px;
}
 
.profile-status {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 14px;
  border-radius: 20px;
  background: #d4edda;
  color: #27ae60;
  font-weight: 700;
  font-size: 14px;
  margin-bottom: 25px;
}
 
.profile-status-dot {
  width: 10px;
  height: 10px;
  border-radius: 50%;
  background: #27ae60;
}
 
.profile-actions {
  display: flex;
  gap: 12px;
  justify-content: center;
}
 
.profile-btn {
  padding: 12px 24px;
  border-radius: 12px;
  border: 2px solid #333;
  background: #fff;
  cursor: pointer;
  font-weight: 700;
  font-size: 16px;
  transition: all 0.2s ease;
  display: flex;
  align-items: center;
  gap: 8px;
}
 
.profile-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
}
 
.profile-btn.primary {
  background: #27ae60;
  color: #fff;
  border-color: #27ae60;
}
 
.profile-btn.primary:hover {
  background: #229954;
  border-color: #229954;
}
 
.profile-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}
 
/* Invite Friends Modal */
.invite-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(3px);
  z-index: 1002;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease;
}
 
.invite-modal.show {
  display: flex;
}
 
.invite-card {
  background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
  border: 3px solid #333;
  border-radius: 20px;
  padding: 35px 40px;
  box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  max-width: 450px;
  width: 90%;
  position: relative;
}
 
.invite-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: transparent;
  border: none;
  font-size: 28px;
  cursor: pointer;
  color: #666;
  transition: all 0.2s;
  width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}
 
.invite-close:hover {
  background: #f0f0f0;
  color: #333;
  transform: rotate(90deg);
}
 
.invite-title {
  font-size: 24px;
  font-weight: 900;
  margin-bottom: 20px;
  text-align: center;
}
 
.invite-list {
  max-height: 300px;
  overflow-y: auto;
  margin-bottom: 20px;
}
 
.invite-item {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 12px;
  border-radius: 10px;
  background: #f8f9fa;
  margin-bottom: 8px;
  transition: all 0.2s;
}
 
.invite-item:hover {
  background: #e9ecef;
  transform: translateX(4px);
}
 
.invite-user-info {
  display: flex;
  align-items: center;
  gap: 12px;
}
 
.invite-user-avatar {
  width: 40px;
  height: 40px;
  border-radius: 50%;
  border: 2px solid #333;
  object-fit: cover;
  background: #f0f0f0;
}
 
.invite-user-name {
  font-weight: 700;
  color: #333;
}
 
.invite-btn {
  padding: 8px 16px;
  border-radius: 8px;
  border: 2px solid #333;
  background: #27ae60;
  color: #fff;
  cursor: pointer;
  font-weight: 700;
  font-size: 14px;
  transition: all 0.2s;
}
 
.invite-btn:hover {
  background: #229954;
  transform: scale(1.05);
}
 
.invite-btn:disabled {
  opacity: 0.5;
  cursor: not-allowed;
  transform: none !important;
}
 
.invite-empty {
  text-align: center;
  padding: 40px 20px;
  color: #666;
  font-size: 16px;
}
 
@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}
 
@keyframes popIn {
  0% {
    transform: scale(0.5) translateY(30px);
    opacity: 0;
  }
  50% {
    transform: scale(1.05) translateY(-5px);
  }
  100% {
    transform: scale(1) translateY(0);
    opacity: 1;
  }
}
 
@keyframes shake {
  0%, 100% { transform: translateX(0); }
  10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
  20%, 40%, 60%, 80% { transform: translateX(5px); }
}
 
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.1); }
}
 
@media (max-width: 768px) {
  .chat-sidebar { width: 300px; height: 80%; padding: 20px; right: 2%; top: 5%; }
  .fire { width: 15%; }
  #chairs img { width: 10%; }
  .dino { width: 11%; }
  .back-btn { width: 45px; height: 45px; }
  .kick-card { padding: 40px 30px; }
  .kick-title { font-size: 26px; }
  .kick-message { font-size: 18px; }
  .kick-countdown { font-size: 40px; }
  .music-control { bottom: 2%; left: 2%; gap: 10px; }
  .music-btn { width: 45px; height: 45px; font-size: 22px; }
  .volume-control { gap: 10px; }
  .volume-slider { width: 100px; height: 8px; }
  .volume-value { font-size: 16px; min-width: 45px; }
  .volume-label { font-size: 18px; }
}

/* Mini Game Modal */
.minigame-modal {
  display: none;
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.6);
  backdrop-filter: blur(3px);
  z-index: 1003;
  justify-content: center;
  align-items: center;
  animation: fadeIn 0.3s ease;
}

.minigame-modal.show {
  display: flex;
}

.minigame-card {
  background: linear-gradient(135deg, #fff 0%, #f8f9fa 100%);
  border: 3px solid #333;
  border-radius: 20px;
  padding: 35px 40px;
  box-shadow: 0 15px 50px rgba(0, 0, 0, 0.3);
  animation: popIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  max-width: 600px;
  width: 90%;
  position: relative;
}

.minigame-close {
  position: absolute;
  top: 15px;
  right: 15px;
  background: transparent;
  border: none;
  font-size: 28px;
  cursor: pointer;
  color: #666;
  transition: all 0.2s;
  width: 35px;
  height: 35px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.minigame-close:hover {
  background: #f0f0f0;
  color: #333;
  transform: rotate(90deg);
}

.minigame-title {
  font-size: 28px;
  font-weight: 900;
  margin-bottom: 25px;
  text-align: center;
  color: #333;
}

.minigame-grid {
  display: grid;
  grid-template-columns: repeat(2, 1fr);
  gap: 20px;
  margin-top: 20px;
}

.game-card {
  background: #fff;
  border: 3px solid #333;
  border-radius: 15px;
  padding: 20px;
  text-align: center;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 4px 4px 0px #333;
}

.game-card:hover {
  transform: translateY(-5px);
  box-shadow: 6px 6px 0px #333;
  background: #f8f9fa;
}

.game-card:active {
  transform: translateY(-2px);
  box-shadow: 3px 3px 0px #333;
}

.game-image {
  width: 100%;
  height: 150px;
  object-fit: cover;
  border-radius: 10px;
  margin-bottom: 15px;
  border: 2px solid #333;
  background: #e9ecef;
}

.game-name {
  font-size: 20px;
  font-weight: 700;
  color: #333;
  margin-bottom: 8px;
}

.game-description {
  font-size: 14px;
  color: #666;
  line-height: 1.4;
}

@media (max-width: 768px) {
  .minigame-grid {
    grid-template-columns: 1fr;
  }
  
  .minigame-card {
    padding: 25px 20px;
  }
}

/* ==== Minesweeper Game ==== */
.minesweeper {
  font-family: Arial, Helvetica, sans-serif;
  font-weight: bold;
  text-align: center;
}

#ms-board {
  width: 400px;
  height: 400px;
  border: 10px solid darkgray;
  background-color: lightgray;

  margin: 0 auto;
  display: flex;
  flex-wrap: wrap;
}

#ms-board div {
  width: 48px;
  height: 48px;
  border: 1px solid whitesmoke;

  font-size: 30px;
  display: flex;
  justify-content: center;
  align-items: center;
}

.ms-tile-clicked {
  background-color: darkgrey;
}

.ms-x1 { color: blue; }
.ms-x2 { color: green; }
.ms-x3 { color: red; }
.ms-x4 { color: navy; }
.ms-x5 { color: brown; }
.ms-x6 { color: teal; }
.ms-x7 { color: black; }
.ms-x8 { color: gray; }

#ms-flag-button {
  width: 100px;
  height: 50px;
  font-size: 30px;
  background-color: lightgray;
  border: none;
  cursor: pointer;
}

</style>
</head>
<body>
 
<img src="./assets/images/back.png" alt="Back" class="back-btn" id="backBtn">
 
<div class="music-control">
  <button class="music-btn" id="musicBtn" title="‡πÄ‡∏õ‡∏¥‡∏î/‡∏õ‡∏¥‡∏î‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡πÄ‡∏û‡∏•‡∏á">
    üéµ
  </button>
 
  <div class="volume-control" id="volumeControl">
    <div class="volume-label">üîä</div>
    <input type="range" min="0" max="100" value="3" class="volume-slider" id="volumeSlider">
    <div class="volume-value" id="volumeValue">3%</div>
  </div>
</div>
 
<audio id="bgMusic" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/05/27/audio_1808fbf07a.mp3" type="audio/mpeg">
</audio>
 
<div class="scene">
  <img src="./assets/images/caveicon.png" alt="Cave" class="cave">
  <img src="./assets/images/fireicon.png" alt="Fire" class="fire" id="fire">
  <div id="chairs"></div>
  <div id="characters"></div>
</div>
 
<div class="chat-sidebar">
  <h2>üí¨ Chat üí¨</h2>
  <button class="settings-btn" id="settingsBtn" title="Settings">‚öôÔ∏è</button>
  <div class="online-users" id="onlineUsers">‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: 0</div>
  <div class="chat-messages" id="chatMessages"></div>
  <div class="chat-input">
    <button class="hamburger-btn" id="hamburgerBtn" title="Menu">‚ò∞</button>
    <input type="text" id="messageInput" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°...">
    <button id="sendBtn">‡∏™‡πà‡∏á</button>
  </div>
 
  <div class="hamburger-menu" id="hamburgerMenu">
    <button class="menu-item" id="miniGameBtn">üéÆ Mini Game</button>
    <button class="menu-item" id="inviteFriendBtn">üë• ‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</button>
  </div>
 
<!-- Kick Modal -->
<div class="kick-modal" id="kickModal">
  <div class="kick-card">
    <div class="kick-icon">‚ö†Ô∏è</div>
    <div class="kick-title">‡∏ñ‡∏π‡∏Å‡πÄ‡∏ï‡∏∞‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á!</div>
    <div class="kick-message">
      ‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏î‡πâ‡∏•‡∏ö‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß<br>
      ‡∏Ñ‡∏∏‡∏ì‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏ô‡∏≥‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡∏•‡πá‡∏≠‡∏ö‡∏ö‡∏µ‡πâ
    </div>
    <div class="kick-countdown" id="kickCountdown">3</div>
  </div>
</div>
 
<!-- Profile Modal -->
<div class="profile-modal" id="profileModal">
  <div class="profile-card">
    <button class="profile-close" id="profileClose">√ó</button>
    <img src="./assets/images/default-profile.png" alt="Profile" class="profile-avatar" id="profileAvatar">
    <div class="profile-username" id="profileUsername">Username</div>
    <div class="profile-status">
      <span class="profile-status-dot"></span>
      <span>‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</span>
    </div>
    <div class="profile-actions">
      <button class="profile-btn primary" id="addFriendBtn">
        <span>üë•</span>
        <span>‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</span>
      </button>
    </div>
  </div>
</div>
 
<!-- Invite Friends Modal -->
<div class="invite-modal" id="inviteModal">
  <div class="invite-card">
    <button class="invite-close" id="inviteClose">√ó</button>
    <h2 class="invite-title">üë• ‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á</h2>
    <div class="invite-list" id="inviteList">
      <!-- Friends list will be populated here -->
    </div>
  </div>
</div>

<!-- Mini Game Modal -->
<div class="minigame-modal" id="minigameModal">
  <div class="minigame-card">
    <button class="minigame-close" id="minigameClose">√ó</button>
    <h2 class="minigame-title">üéÆ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà‡∏à‡∏∞‡πÄ‡∏•‡πà‡∏ô</h2>

    <!-- ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏° -->
    <div class="minigame-grid" id="minigameGrid">
      <div class="game-card" data-game="game1">
        <img src="./assets/images/game1.png" alt="Game 1" class="game-image">
        <div class="game-name">üéØ ‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà 1</div>
        <div class="game-description">Minesweeper ‡πÄ‡∏Ñ‡∏•‡∏µ‡∏¢‡∏£‡πå‡∏£‡∏∞‡πÄ‡∏ö‡∏¥‡∏î‡πÉ‡∏´‡πâ‡∏´‡∏°‡∏î!</div>
      </div>
      <div class="game-card" data-game="game2">
        <img src="./assets/images/game2.png" alt="Game 2" class="game-image">
        <div class="game-name">üé≤ ‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà 2</div>
        <div class="game-description">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà 2</div>
      </div>
    </div>

    <!-- ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° Minesweeper -->
    <div id="minesweeper-container" class="minesweeper" style="display:none;">
      <h2>Mines: <span id="ms-mines-count">0</span></h2>
      <div id="ms-board"></div>
      <br>
      <button id="ms-flag-button">üö©</button>
      <br><br>
      <button id="ms-back-button"
        style="margin-top:10px; padding:8px 16px; border-radius:10px; border:2px solid #333; cursor:pointer;">
        ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°
      </button>
    </div>
    <!-- ‡πÇ‡∏´‡∏°‡∏î‡πÄ‡∏•‡πà‡∏ô‡πÄ‡∏Å‡∏° Snake (‡πÄ‡∏Å‡∏°‡∏ó‡∏µ‡πà 2) -->
    <div id="snake-container" class="flappy-container" style="display:none;">
      <div class="flappy-title">SNAKE GAME</div>
      <div class="flappy-screen">
        <canvas id="snakeboard"></canvas>
        <p id="snake-score">Score: 0</p>
      </div>
      <button id="snake-back-button" class="flappy-back-btn">
        ‚Üê ‡∏Å‡∏•‡∏±‡∏ö‡πÑ‡∏õ‡∏´‡∏ô‡πâ‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏Å‡∏°
      </button>
    </div>
  </div>
</div>

 
<script type="module">
  import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
  import {
    getDatabase, ref, push, onValue, onChildAdded, set, onDisconnect,
    serverTimestamp, remove, update, get
  } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
 
  const firebaseConfig = {
    apiKey: "AIzaSyAVnoP0I5eMuPLWfCZTagmuVKZgOFM-S6o",
    authDomain: "anonymous-talk-chat-67d1a.firebaseapp.com",
    databaseURL: "https://anonymous-talk-chat-67d1a-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "anonymous-talk-chat-67d1a",
    storageBucket: "anonymous-talk-chat-67d1a.firebasestorage.app",
    messagingSenderId: "1007242493297",
    appId: "1:1007242493297:web:1e0589e885c3cb80c40ad0"
  };
 
  const app = initializeApp(firebaseConfig);
  const database = getDatabase(app);
 
  const username = localStorage.getItem("chatUsername") || "‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ä‡∏∑‡πà‡∏≠";
  const roomId = localStorage.getItem('currentRoomId') || 'default-room';
  const userId = localStorage.getItem("userId") || (() => {
    const id = 'user_' + Date.now() + '_' + Math.random().toString(36).slice(2, 9);
    localStorage.setItem("userId", id);
    return id;
  })();
  // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏≠‡∏ß‡∏ï‡∏≤‡∏£‡πå‡∏ó‡∏µ‡πà‡πÅ‡∏ï‡πà‡∏á‡πÑ‡∏ß‡πâ
let equipped = {
  skin: "skin-base",
  hat: null,
  face: null,
  other: null
};

try {
  const saved = JSON.parse(localStorage.getItem("avatar_equipped") || "null");
  if (saved) {
    equipped.skin  = saved.skin  || "skin-base";
    equipped.hat   = saved.hat   || null;
    equipped.face  = saved.face  || null;
    equipped.other = saved.other || null;
  }
} catch (e) {
  console.log("Could not load avatar data:", e);
}
 
  const messagesRef = ref(database, `rooms/${roomId}/messages`);
  const usersRef    = ref(database, `rooms/${roomId}/users`);
  const myUserRef   = ref(database, `rooms/${roomId}/users/${userId}`);
  const roomRef     = ref(database, `rooms/${roomId}`);
 
  const chatBox = document.getElementById("chatMessages");
  const input = document.getElementById("messageInput");
  const btn = document.getElementById("sendBtn");
  const onlineUsersEl = document.getElementById("onlineUsers");
  const chairContainer = document.getElementById("chairs");
  const characterContainer = document.getElementById("characters");
  const kickModal = document.getElementById("kickModal");
  const kickCountdown = document.getElementById("kickCountdown");
  const musicBtn = document.getElementById("musicBtn");
  const bgMusic = document.getElementById("bgMusic");
  const volumeControl = document.getElementById("volumeControl");
  const volumeSlider = document.getElementById("volumeSlider");
  const volumeValue = document.getElementById("volumeValue");
 
  const profileModal = document.getElementById("profileModal");
  const profileClose = document.getElementById("profileClose");
  const profileAvatar = document.getElementById("profileAvatar");
  const profileUsername = document.getElementById("profileUsername");
  const addFriendBtn = document.getElementById("addFriendBtn");
 
  const inviteModal = document.getElementById("inviteModal");
  const inviteClose = document.getElementById("inviteClose");
  const inviteList = document.getElementById("inviteList");
 
  const maxPlayers = 10;
  let countdownTimer = null;
  let isKicked = false;
  let isMusicPlaying = false;
  let currentProfileUser = null;
  let roomUsersData = {};
 
  const hamburgerBtn = document.getElementById("hamburgerBtn");
  const hamburgerMenu = document.getElementById("hamburgerMenu");
  const settingsBtn = document.getElementById("settingsBtn");
  const miniGameBtn = document.getElementById("miniGameBtn");
  const inviteFriendBtn = document.getElementById("inviteFriendBtn");
 
  hamburgerBtn?.addEventListener("click", (e) => {
    e.stopPropagation();
    hamburgerMenu.classList.toggle("show");
  });
 
  document.addEventListener("click", (e) => {
    if (!e.target.closest('.hamburger-btn') && !e.target.closest('.hamburger-menu')) {
      hamburgerMenu.classList.remove("show");
    }
  });
 
  settingsBtn?.addEventListener("click", () => {
    alert("Settings (Coming soon)");
  });
 
  // Mini Game Modal
const minigameModal = document.getElementById("minigameModal");
const minigameClose = document.getElementById("minigameClose");

function showMinigameModal() {
  minigameModal.classList.add("show");
  hamburgerMenu.classList.remove("show");
}

function closeMinigameModal() {
  minigameModal.classList.remove("show");
}

miniGameBtn?.addEventListener("click", () => {
  showMinigameModal();
});

minigameClose?.addEventListener("click", closeMinigameModal);

minigameModal?.addEventListener("click", (e) => {
  if (e.target === minigameModal) {
    closeMinigameModal();
  }
});

// Handle game selection
document.querySelectorAll(".game-card").forEach(card => {
  card.addEventListener("click", () => {
    const gameType = card.dataset.game;

    if (gameType === "game1") {
      showMinesweeper();
    } 
    else if (gameType === "game2") {
      showSnakeGame();
    }
  });
});

function showMinesweeper() {
  const grid = document.getElementById("minigameGrid");
  const minesContainer = document.getElementById("minesweeper-container");
  if (!grid || !minesContainer) return;

  grid.style.display = "none";
  minesContainer.style.display = "block";

  initMinesweeper();
}

function hideMinesweeper() {
  const grid = document.getElementById("minigameGrid");
  const minesContainer = document.getElementById("minesweeper-container");
  if (!grid || !minesContainer) return;

  minesContainer.style.display = "none";
  grid.style.display = "grid";
}

document.getElementById("ms-back-button")?.addEventListener("click", hideMinesweeper);

 
  // ====== Profile Modal Functions ======
  function getFriends() {
    try {
      return JSON.parse(localStorage.getItem("friends") || "[]");
    } catch {
      return [];
    }
  }
 
  function saveFriends(friends) {
    localStorage.setItem("friends", JSON.stringify(friends));
  }
 
  function isFriend(username) {
    const friends = getFriends();
    return friends.some(f => f.name === username);
  }
 
  function showProfileModal(clickedUsername, clickedUserId) {
    if (clickedUsername === username) return;
   
    currentProfileUser = { name: clickedUsername, id: clickedUserId };
   
    profileUsername.textContent = clickedUsername;
    profileAvatar.src = "./assets/images/default-profile.png";
   
    if (addFriendBtn) addFriendBtn.style.display = '';
   
    profileModal.classList.add("show");
  }
 
  function closeProfileModal() {
    profileModal.classList.remove("show");
    currentProfileUser = null;
  }
 
  profileClose?.addEventListener("click", closeProfileModal);
 
  profileModal?.addEventListener("click", (e) => {
    if (e.target === profileModal) {
      closeProfileModal();
    }
  });
 
if (addFriendBtn) {
  addFriendBtn.style.display = '';
  addFriendBtn.addEventListener('click', async () => {
    if (!currentProfileUser || !currentProfileUser.id) {
      return alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡πÄ‡∏õ‡πâ‡∏≤‡∏´‡∏°‡∏≤‡∏¢');
    }

    const payload = {
      type: 'friend_request',
      fromId: userId,
      fromName: username,
      toId: currentProfileUser.id,
      status: 'pending',
      createdAt: Date.now(),
      unread: true
    };

    console.log('=== DEBUG: Sending Friend Request ===');
    console.log('From:', userId, username);
    console.log('To:', currentProfileUser.id, currentProfileUser.name);
    console.log('Payload:', payload);
    console.log('Path:', `notifications/${currentProfileUser.id}`);

    try {
      const notifRef = ref(database, `notifications/${currentProfileUser.id}`);
      console.log('Reference created:', notifRef);
      
      const result = await push(notifRef, payload);
      console.log('‚úÖ Push successful! Key:', result.key);

      addFriendBtn.textContent = '‚úì ‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÅ‡∏•‡πâ‡∏ß';
      addFriendBtn.disabled = true;
      addFriendBtn.classList.remove('primary');
      alert(`‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÄ‡∏õ‡πá‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏õ‡∏´‡∏≤ ${currentProfileUser.name} ‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡∏£‡πâ‡∏≠‡∏¢`);
      closeProfileModal();
    } catch (err) {
      console.error('‚ùå Error sending friend request:', err);
      console.error('Error code:', err.code);
      console.error('Error message:', err.message);
      console.error('Full error:', JSON.stringify(err, null, 2));
      alert('‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡∏Ç‡∏≠‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + (err.message || String(err)));
    }
  });
}
 
  // ====== Invite Friends Modal Functions ======
  function showInviteModal() {
    console.log('üîç Opening invite modal...');
    const friends = getFriends();
    console.log('üë• Friends list:', friends);
   
    if (friends.length === 0) {
      inviteList.innerHTML = `
        <div class="invite-empty">
          <p>üò¢ ‡∏Ñ‡∏∏‡∏ì‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô</p>
          <p style="font-size: 14px; margin-top: 10px;">‡∏•‡∏≠‡∏á‡πÅ‡∏≠‡∏î‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏≤‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏¥‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏∞!</p>
        </div>
      `;
    } else {
      inviteList.innerHTML = friends.map(friend => `
        <div class="invite-item" data-friend="${friend.name}">
          <div class="invite-user-info">
            <img src="./assets/images/default-profile.png" alt="${friend.name}" class="invite-user-avatar">
            <span class="invite-user-name">${friend.name}</span>
          </div>
          <button class="invite-btn" data-friend-name="${friend.name}">‡πÄ‡∏ä‡∏¥‡∏ç</button>
        </div>
      `).join("");
     
      document.querySelectorAll(".invite-btn").forEach(btn => {
        btn.addEventListener("click", async () => {
          console.log('üéØ Invite button clicked!');
          const friendName = btn.dataset.friendName;
          console.log('üìù Friend name:', friendName);
          
          // ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤ userId ‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏à‡∏≤‡∏Å roomUsersData
          let friendUserId = null;
          console.log('üîç Searching in roomUsersData:', roomUsersData);
          
          for (const [uid, userData] of Object.entries(roomUsersData)) {
            console.log(`Checking user: ${uid} -> ${userData.name}`);
            if (userData.name === friendName) {
              friendUserId = uid;
              console.log('‚úÖ Found userId:', friendUserId);
              break;
            }
          }

          // ‡∏ñ‡πâ‡∏≤‡πÑ‡∏°‡πà‡∏û‡∏ö‡πÉ‡∏ô room ‡∏õ‡∏±‡∏à‡∏à‡∏∏‡∏ö‡∏±‡∏ô
          if (!friendUserId) {
            console.warn(`‚ö†Ô∏è Cannot find userId for ${friendName} in current room`);
            // ‡∏•‡∏≠‡∏á‡∏´‡∏≤‡∏à‡∏≤‡∏Å localStorage
            const allUsers = JSON.parse(localStorage.getItem('allKnownUsers') || '{}');
            friendUserId = allUsers[friendName];
            console.log('üîç Tried localStorage, result:', friendUserId);
          }
         
          try {
            const currentRoom = JSON.parse(localStorage.getItem('currentRoom') || '{}');
            const roomName = currentRoom.name || '‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó';
            
            console.log('üì§ Preparing to send notification...');
            console.log('Room ID:', roomId);
            console.log('Room Name:', roomName);
            console.log('Friend User ID:', friendUserId);
            
            // ‡∏™‡πà‡∏á notification ‡πÑ‡∏õ‡∏¢‡∏±‡∏á path ‡∏Ç‡∏≠‡∏á‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô
            if (friendUserId) {
              const friendNotifRef = ref(database, `notifications/${friendUserId}`);
              console.log('üìç Notification path:', `notifications/${friendUserId}`);
              
              const notifPayload = {
                type: 'room_invite',
                fromId: userId,
                fromName: username,
                roomId: roomId,
                roomName: roomName,
                message: `${username} ‡πÄ‡∏ä‡∏¥‡∏ç‡∏Ñ‡∏∏‡∏ì‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á "${roomName}"`,
                title: 'üéÆ ‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á',
                createdAt: Date.now(),
                status: 'unread',
                unread: true
              };
              
              console.log('üì¶ Notification payload:', notifPayload);
              
              await push(friendNotifRef, notifPayload);
              console.log('‚úÖ Notification sent successfully!');
            } else {
              console.error('‚ùå No friendUserId found, cannot send notification');
              alert('‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ‡∏™‡∏±‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏Å‡πà‡∏≠‡∏ô');
              return;
            }

            // ‡∏™‡πà‡∏á‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡πÉ‡∏ô‡πÅ‡∏ä‡∏ó‡∏î‡πâ‡∏ß‡∏¢
            console.log('üí¨ Sending chat message...');
            await push(messagesRef, {
              user: "System",
              text: `üìß ${username} ‡πÑ‡∏î‡πâ‡πÄ‡∏ä‡∏¥‡∏ç ${friendName} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á`,
              timestamp: Date.now()
            });
            console.log('‚úÖ Chat message sent!');
           
            alert(`‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç‡πÑ‡∏õ‡∏´‡∏≤ ${friendName} ‡πÅ‡∏•‡πâ‡∏ß!`);
            btn.textContent = "‚úì ‡∏™‡πà‡∏á‡πÅ‡∏•‡πâ‡∏ß";
            btn.disabled = true;
          } catch (error) {
            console.error("‚ùå Error inviting friend:", error);
            console.error("Error details:", error.message, error.stack);
            alert("‡πÄ‡∏Å‡∏¥‡∏î‡∏Ç‡πâ‡∏≠‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î‡πÉ‡∏ô‡∏Å‡∏≤‡∏£‡∏™‡πà‡∏á‡∏Ñ‡∏≥‡πÄ‡∏ä‡∏¥‡∏ç: " + error.message);
          }
        });
      });
    }
   
    console.log('‚úÖ Modal should be visible now');
    inviteModal.classList.add("show");
    hamburgerMenu.classList.remove("show");
  }
 
  function closeInviteModal() {
    inviteModal.classList.remove("show");
  }
 
  // ====== Invite Friend Button ======
  inviteFriendBtn?.addEventListener("click", () => {
    console.log('üéØ Invite Friend button clicked!');
    showInviteModal();
  });
  
  inviteClose?.addEventListener("click", closeInviteModal);
 
  inviteModal?.addEventListener("click", (e) => {
    if (e.target === inviteModal) {
      closeInviteModal();
    }
  });
 
  bgMusic.volume = 0.03;
 
  musicBtn.addEventListener("click", (e) => {
    e.stopPropagation();
    if (isMusicPlaying) {
      bgMusic.pause();
      musicBtn.textContent = "üéµ";
      musicBtn.classList.remove("playing");
      volumeControl.classList.remove("show");
      isMusicPlaying = false;
    } else {
      bgMusic.play().then(() => {
        musicBtn.textContent = "üé∂";
        musicBtn.classList.add("playing");
        volumeControl.classList.add("show");
        isMusicPlaying = true;
      }).catch(err => {
        console.log("Cannot play audio:", err);
      });
    }
  });
 
  document.addEventListener("click", (e) => {
    if (!e.target.closest('.music-control')) {
      volumeControl.classList.remove("show");
    }
  });
 
  volumeControl.addEventListener("click", (e) => {
    e.stopPropagation();
  });
 
  volumeSlider.addEventListener("input", (e) => {
    const volume = e.target.value / 100;
    bgMusic.volume = volume;
    volumeValue.textContent = e.target.value + "%";
   
    const percentage = e.target.value;
    volumeSlider.style.background = `linear-gradient(to right, #27ae60 0%, #27ae60 ${percentage}%, rgba(255,255,255,0.7) ${percentage}%, rgba(255,255,255,0.7) 100%)`;
   
    const label = volumeControl.querySelector('.volume-label');
    if (volume === 0) {
      label.textContent = "üîá";
    } else if (volume < 0.3) {
      label.textContent = "üîà";
    } else if (volume < 0.7) {
      label.textContent = "üîâ";
    } else {
      label.textContent = "üîä";
    }
  });
 
  function autoPlayMusic() {
    bgMusic.play().then(() => {
      musicBtn.textContent = "üé∂";
      musicBtn.classList.add("playing");
      volumeControl.classList.add("show");
      isMusicPlaying = true;
    }).catch(err => {
      document.body.addEventListener('click', () => {
        if (!isMusicPlaying && bgMusic.paused) {
          bgMusic.play().then(() => {
            musicBtn.textContent = "üé∂";
            musicBtn.classList.add("playing");
            volumeControl.classList.add("show");
            isMusicPlaying = true;
          }).catch(() => {});
        }
      }, { once: true });
    });
  }
 
  autoPlayMusic();
 
  function showKickModal() {
    if (isKicked) return;
    isKicked = true;
 
    kickModal.classList.add('show');
   
    let countdown = 3;
    kickCountdown.textContent = countdown;
 
    countdownTimer = setInterval(() => {
      countdown--;
      if (countdown > 0) {
        kickCountdown.textContent = countdown;
      } else {
        clearInterval(countdownTimer);
        redirectToLobby();
      }
    }, 1000);
  }
 
  async function redirectToLobby() {
    try {
      await remove(myUserRef);
    } catch(e) {
      console.log('Error removing user:', e);
    }
   
    localStorage.removeItem('playerJoined');
    localStorage.removeItem('currentRoomId');
    window.location.href = "chatpage.html";
  }
 
  function renderMessage(user, text, isOwn = false, senderId = null) {
    const p = document.createElement("p");
    if (user === "System") {
      p.className = "system";
      p.textContent = text;
    } else {
      p.className = isOwn ? "own-message" : "";
     
      const usernameSpan = document.createElement("span");
      usernameSpan.className = "username";
      usernameSpan.textContent = user;
     
      if (!isOwn && senderId) {
        usernameSpan.style.cursor = "pointer";
        usernameSpan.addEventListener("click", () => {
          showProfileModal(user, senderId);
        });
      }
     
      const strong = document.createElement("strong");
      strong.appendChild(usernameSpan);
      strong.appendChild(document.createTextNode(": "));
     
      p.appendChild(strong);
      p.appendChild(document.createTextNode(text));
    }
    chatBox.appendChild(p);
    chatBox.scrollTop = chatBox.scrollHeight;
  }
 
  function sendMessage() {
    const text = input.value.trim();
    if (!text) return;
    push(messagesRef, {
      user: username,
      userId: userId,
      text,
      timestamp: Date.now()
    });
    input.value = "";
  }
  btn.addEventListener("click", sendMessage);
  input.addEventListener("keypress", e => { if (e.key === "Enter") sendMessage(); });
 
  const joinTime = Date.now();
  let isFirstLoad = true;
 
  await set(myUserRef, { 
  name: username, 
  joinedAt: Date.now(), 
  joinTime,
  avatar: equipped 
});
  onDisconnect(myUserRef).remove();
 
  onChildAdded(messagesRef, (snap) => {
    const data = snap.val();
   
    if (isFirstLoad) {
      return;
    }
   
    renderMessage(data.user, data.text, data.user === username, data.userId);
  });
 
  setTimeout(() => {
    isFirstLoad = false;
  }, 1000);
 
  let previousUsers = {};
  let isFirstUserLoad = true;
  
  // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å userId ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏Ñ‡∏¢‡πÄ‡∏à‡∏≠
  function saveKnownUser(uid, name) {
    try {
      const allUsers = JSON.parse(localStorage.getItem('allKnownUsers') || '{}');
      allUsers[name] = uid;
      localStorage.setItem('allKnownUsers', JSON.stringify(allUsers));
      console.log(`üíæ Saved user: ${name} -> ${uid}`);
    } catch (e) {
      console.error('Error saving known user:', e);
    }
  }
 
  onValue(usersRef, async (snapshot) => {
    const users = snapshot.val() || {};
    roomUsersData = users;
    const currentUserIds = Object.keys(users);
    const count = currentUserIds.length;
    
    // ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å userId ‡∏Ç‡∏≠‡∏á‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á
    Object.entries(users).forEach(([uid, userData]) => {
      if (userData && userData.name) {
        saveKnownUser(uid, userData.name);
      }
    });
 
    onlineUsersEl.textContent = `‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå: ${count}`;
    await update(roomRef, { currentPlayers: count });
 
    if (isFirstUserLoad) {
      previousUsers = { ...users };
      isFirstUserLoad = false;
      updateCharacters(count);
      return;
    }
 
    const previousUserIds = Object.keys(previousUsers);
    if (previousUserIds.length > 0) {
      previousUserIds.forEach(uid => {
        if (!currentUserIds.includes(uid) && uid !== userId) {
          const leftUser = previousUsers[uid];
          push(messagesRef, {
            user: "System",
            text: `‚ùå ${leftUser.name} ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó`,
            timestamp: Date.now()
          });
        }
      });
    }
   
    previousUsers = { ...users };
    updateCharacters(count);
  });
 
  onValue(roomRef, (snapshot) => {
    const roomData = snapshot.val();
   
    if (!roomData || roomData.deleted === true) {
      showKickModal();
    }
  });
 
  function placeChairs() {
    chairContainer.innerHTML = "";
    const centerX = window.innerWidth / 2;
    const centerY = window.innerHeight * 0.7;
    const radius = 230;
    for (let i = 0; i < maxPlayers; i++) {
      const angle = (i / maxPlayers) * 2 * Math.PI;
      const x = centerX + radius * Math.cos(angle);
      const y = centerY + radius * Math.sin(angle);
      const chair = document.createElement("img");
      chair.src = "./assets/images/chairicon.png";
      chair.className = "chair";
      chair.style.left = `${x}px`;
      chair.style.top  = `${y}px`;
      chairContainer.appendChild(chair);
    }
  }
 
  function updateCharacters(count) {
  characterContainer.innerHTML = '';
  const current = Math.min(count, maxPlayers);
  const chairs = document.querySelectorAll("#chairs img");
  
  // AVATAR ASSET INDEX
  const SHOP_ITEMS = {
    skin: [
      { id: "skin-none", img: "./assets/avatar/empty.png" },
      { id: "skin-base", img: "./assets/avatar/dino.png" },
      { id: "skin-classic", avatarImg: "./assets/avatar/skin1.png", fullBody: true },
      { id: "skin-night", avatarImg: "./assets/avatar/skin2.png", fullBody: true },
      { id: "skin-pastel", avatarImg: "./assets/avatar/skin3.png", fullBody: true }
    ],
    hat: [
      { id: "hat-none", img: "./assets/avatar/empty.png" },
      { id: "hat-top", avatarImg: "./assets/avatar/avatar_hat1.png", fullBody: true },
      { id: "hat-cap", avatarImg: "./assets/avatar/avatar_hat2.png", fullBody: true },
      { id: "hat-beret", avatarImg: "./assets/avatar/avatar_hat3.png", fullBody: true }
    ],
    face: [
      { id: "face-cool", img: "./assets/shop/face_cool.png" },
      { id: "face-cute", img: "./assets/shop/face_cute.png" },
      { id: "face-mask", img: "./assets/shop/face_mask.png" }
    ],
    other: [
      { id: "other-none", img: "./assets/avatar/empty.png" },
      { id: "other-water", avatarImg: "./assets/avatar/avatar_gun.png", fullBody: true },
      { id: "other-bag", avatarImg: "./assets/avatar/avatar_burger.png", fullBody: true },
      { id: "other-flag", avatarImg: "./assets/avatar/avatar_burger.png", fullBody: true }
    ]
  };

  const AVATAR_ASSET_INDEX = {};
  Object.entries(SHOP_ITEMS).forEach(([cat, items]) => {
    items.forEach((it) => {
      AVATAR_ASSET_INDEX[it.id] = {
        slot: cat,
        img: it.avatarImg || it.img,
        fullBody: !!it.fullBody
      };
    });
  });

  function getAvatarImage() {
    const hatAsset = equipped.hat ? AVATAR_ASSET_INDEX[equipped.hat] : null;
    const useHatAsFullBody = hatAsset?.fullBody;

    if (useHatAsFullBody) {
      return hatAsset.img || "./assets/avatar/dino.png";
    }

    const skinAsset = equipped.skin ? AVATAR_ASSET_INDEX[equipped.skin] : null;
    return skinAsset?.img || "./assets/avatar/dino.png";
  }

  for (let i = 0; i < current; i++) {
    const rect = chairs[i].getBoundingClientRect();
    const dino = document.createElement("img");
    dino.src = getAvatarImage();
    dino.className = "dino";
    dino.style.left = `${rect.left + rect.width / 2}px`;
    dino.style.top  = `${rect.top + rect.height / 2}px`;
    dino.style.animationDuration = `${(2 + Math.random()*1.5).toFixed(2)}s`;
    dino.style.animationDelay    = `${(Math.random()*2).toFixed(2)}s`;
    characterContainer.appendChild(dino);
  }
}
 
  document.getElementById("backBtn").addEventListener("click", async () => {
    if (countdownTimer) clearInterval(countdownTimer);
    try {
      await remove(myUserRef);
    } catch(e) {}
    localStorage.removeItem('playerJoined');
    window.location.href = "chatpage.html";
  });
 
  placeChairs();
 
  if (localStorage.getItem('playerJoined') === 'true') {
    push(messagesRef, {
      user: "System",
      text: `‚úÖ ${username} ‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏´‡πâ‡∏≠‡∏á‡πÅ‡∏ä‡∏ó‡πÅ‡∏•‡πâ‡∏ß`,
      timestamp: Date.now()
    });
  }

  // ===================== Minesweeper Logic =====================
let msBoard = [];
let msRows = 8;
let msColumns = 8;

let msMinesCount = 10;
let msMinesLocation = []; // "r-c"

let msTilesClicked = 0;   // goal: click all tiles except mines
let msFlagEnabled = false;
let msGameOver = false;

function initMinesweeper() {
  msBoard = [];
  msMinesLocation = [];
  msTilesClicked = 0;
  msGameOver = false;
  msFlagEnabled = false;

  const minesCountEl = document.getElementById("ms-mines-count");
  const boardEl = document.getElementById("ms-board");
  const flagBtnEl = document.getElementById("ms-flag-button");

  if (!minesCountEl || !boardEl || !flagBtnEl) return;

  boardEl.innerHTML = "";
  minesCountEl.innerText = msMinesCount;
  flagBtnEl.style.backgroundColor = "lightgray";

  flagBtnEl.onclick = toggleMsFlag;

  setMsMines();

  for (let r = 0; r < msRows; r++) {
    let row = [];
    for (let c = 0; c < msColumns; c++) {
      const tile = document.createElement("div");
      tile.id = `ms-${r}-${c}`;
      tile.addEventListener("click", clickMsTile);
      boardEl.append(tile);
      row.push(tile);
    }
    msBoard.push(row);
  }
}

function setMsMines() {
  let minesLeft = msMinesCount;
  while (minesLeft > 0) {
    const r = Math.floor(Math.random() * msRows);
    const c = Math.floor(Math.random() * msColumns);
    const id = `${r}-${c}`;

    if (!msMinesLocation.includes(id)) {
      msMinesLocation.push(id);
      minesLeft--;
    }
  }
}

function toggleMsFlag() {
  msFlagEnabled = !msFlagEnabled;
  document.getElementById("ms-flag-button").style.backgroundColor =
    msFlagEnabled ? "darkgray" : "lightgray";
}

function clickMsTile() {
  if (msGameOver) return;

  const tile = this;

  if (tile.classList.contains("ms-tile-clicked")) return;

  if (msFlagEnabled) {
    if (tile.innerText === "") {
      tile.innerText = "üö©";
    } else if (tile.innerText === "üö©") {
      tile.innerText = "";
    }
    return;
  }

  const coords = tile.id.replace("ms-", "").split("-");
  const r = parseInt(coords[0]);
  const c = parseInt(coords[1]);

  if (msMinesLocation.includes(`${r}-${c}`)) {
    msGameOver = true;
    revealMsMines();
    return;
  }

  checkMsMine(r, c);
}

function revealMsMines() {
  for (let r = 0; r < msRows; r++) {
    for (let c = 0; c < msColumns; c++) {
      const tile = msBoard[r][c];
      if (msMinesLocation.includes(`${r}-${c}`)) {
        tile.innerText = "üí£";
        tile.style.backgroundColor = "red";
      }
    }
  }
}

function checkMsMine(r, c) {
  if (r < 0 || r >= msRows || c < 0 || c >= msColumns) return;
  const tile = msBoard[r][c];

  if (tile.classList.contains("ms-tile-clicked")) return;

  tile.classList.add("ms-tile-clicked");
  msTilesClicked++;

  let minesFound = 0;

  // top 3
  minesFound += checkMsTile(r - 1, c - 1);
  minesFound += checkMsTile(r - 1, c);
  minesFound += checkMsTile(r - 1, c + 1);

  // left & right
  minesFound += checkMsTile(r, c - 1);
  minesFound += checkMsTile(r, c + 1);

  // bottom 3
  minesFound += checkMsTile(r + 1, c - 1);
  minesFound += checkMsTile(r + 1, c);
  minesFound += checkMsTile(r + 1, c + 1);

  if (minesFound > 0) {
    tile.innerText = minesFound;
    tile.classList.add(`ms-x${minesFound}`);
  } else {
    tile.innerText = "";

    // flood fill
    checkMsMine(r - 1, c - 1);
    checkMsMine(r - 1, c);
    checkMsMine(r - 1, c + 1);

    checkMsMine(r, c - 1);
    checkMsMine(r, c + 1);

    checkMsMine(r + 1, c - 1);
    checkMsMine(r + 1, c);
    checkMsMine(r + 1, c + 1);
  }

  if (msTilesClicked === msRows * msColumns - msMinesCount) {
    document.getElementById("ms-mines-count").innerText = "Cleared";
    msGameOver = true;
  }
}

function checkMsTile(r, c) {
  if (r < 0 || r >= msRows || c < 0 || c >= msColumns) {
    return 0;
  }
  if (msMinesLocation.includes(`${r}-${c}`)) {
    return 1;
  }
  return 0;
}

// ===================== Snake Game Logic (Game 2) =====================

// config ‡∏Ç‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡∏á‡∏π
const snakeBlockSize = 25;
const snakeRows = 20;
const snakeCols = 20;
const snakeSpeed = 100; // ms ‡∏ï‡πà‡∏≠ 1 tick

let snakeBoard;        // <canvas>
let snakeCtx;          // context 2D

let snake = [];
let snakeDirection = { x: 0, y: 0 };
let snakeFood = { x: 5, y: 5 };
let snakeIsGameOver = false;
let snakeScore = 0;
let snakeLoopId = null;

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà
function initSnakeGame() {
  snakeBoard = document.getElementById("snakeboard");
  const scoreEl = document.getElementById("snake-score");

  if (!snakeBoard || !scoreEl) {
    console.error("‚ùå ‡πÑ‡∏°‡πà‡∏û‡∏ö element ‡∏Ç‡∏≠‡∏á Snake (snakeboard / snake-score)");
    return;
  }

  snakeBoard.height = snakeRows * snakeBlockSize;
  snakeBoard.width = snakeCols * snakeBlockSize;
  snakeCtx = snakeBoard.getContext("2d");

  // reset state
  snake = [{ x: 10, y: 10 }];
  snakeDirection = { x: 1, y: 0 }; // ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏¥‡πà‡∏á‡πÑ‡∏õ‡∏ó‡∏≤‡∏á‡∏Ç‡∏ß‡∏≤
  snakeFood = { x: 5, y: 5 };
  snakeIsGameOver = false;
  snakeScore = 0;
  scoreEl.innerText = "Score: 0";

  placeSnakeFood();

  // ‡∏•‡πâ‡∏≤‡∏á loop ‡πÄ‡∏Å‡πà‡∏≤ ‡∏ñ‡πâ‡∏≤‡∏°‡∏µ
  if (snakeLoopId) clearInterval(snakeLoopId);
  snakeLoopId = setInterval(updateSnakeGame, snakeSpeed);

  // ‡∏õ‡πâ‡∏≠‡∏á‡∏Å‡∏±‡∏ô‡πÑ‡∏°‡πà‡πÉ‡∏´‡πâ add ‡∏ã‡πâ‡∏≥
  document.removeEventListener("keydown", handleSnakeKey);
  document.addEventListener("keydown", handleSnakeKey);
}

// ‡∏≠‡∏±‡∏û‡πÄ‡∏î‡∏ï‡∏ó‡∏∏‡∏Å tick
function updateSnakeGame() {
  if (snakeIsGameOver) return;

  const head = {
    x: snake[0].x + snakeDirection.x,
    y: snake[0].y + snakeDirection.y,
  };

  // ‡∏ñ‡πâ‡∏≤‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡∏Å‡∏î‡∏ó‡∏¥‡∏®‡∏ó‡∏≤‡∏á‡πÄ‡∏•‡∏¢ ‡πÑ‡∏°‡πà‡∏Ç‡∏¢‡∏±‡∏ö
  if (snakeDirection.x === 0 && snakeDirection.y === 0) {
    drawSnakeBoard();
    return;
  }

  // ‡∏ä‡∏ô‡∏Å‡∏≥‡πÅ‡∏û‡∏á
  if (
    head.x < 0 || head.x >= snakeCols ||
    head.y < 0 || head.y >= snakeRows
  ) {
    endSnakeGame();
    return;
  }

  // ‡∏ä‡∏ô‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á
  for (let i = 0; i < snake.length; i++) {
    if (head.x === snake[i].x && head.y === snake[i].y) {
      endSnakeGame();
      return;
    }
  }

  snake.unshift(head); // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏´‡∏±‡∏ß‡∏á‡∏π‡πÉ‡∏´‡∏°‡πà

  // ‡∏Å‡∏¥‡∏ô‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  if (head.x === snakeFood.x && head.y === snakeFood.y) {
    snakeScore++;
    const scoreEl = document.getElementById("snake-score");
    if (scoreEl) scoreEl.innerText = `Score: ${snakeScore}`;
    placeSnakeFood();
  } else {
    snake.pop(); // ‡∏ï‡∏±‡∏î‡∏´‡∏≤‡∏á‡∏≠‡∏≠‡∏Å
  }

  drawSnakeBoard();
}

// ‡∏ß‡∏≤‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏Å‡∏£‡∏∞‡∏î‡∏≤‡∏ô
function drawSnakeBoard() {
  if (!snakeCtx || !snakeBoard) return;

  // ‡∏û‡∏∑‡πâ‡∏ô‡∏´‡∏•‡∏±‡∏á
  snakeCtx.fillStyle = "black";
  snakeCtx.fillRect(0, 0, snakeBoard.width, snakeBoard.height);

  // ‡∏ß‡∏≤‡∏î‡∏á‡∏π
  snakeCtx.fillStyle = "lime";
  snake.forEach(part => {
    snakeCtx.fillRect(
      part.x * snakeBlockSize,
      part.y * snakeBlockSize,
      snakeBlockSize,
      snakeBlockSize
    );
  });

  // ‡∏ß‡∏≤‡∏î‡∏≠‡∏≤‡∏´‡∏≤‡∏£
  snakeCtx.fillStyle = "red";
  snakeCtx.fillRect(
    snakeFood.x * snakeBlockSize,
    snakeFood.y * snakeBlockSize,
    snakeBlockSize,
    snakeBlockSize
  );
}

// ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ó‡∏¥‡∏®‡∏à‡∏≤‡∏Å keyboard
function handleSnakeKey(e) {
  // ‡∏ñ‡πâ‡∏≤ container ‡∏ñ‡∏π‡∏Å‡∏ã‡πà‡∏≠‡∏ô‡πÑ‡∏ß‡πâ ‡πÑ‡∏°‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏£‡∏±‡∏ö‡∏õ‡∏∏‡πà‡∏°
  const container = document.getElementById("snake-container");
  if (!container || container.style.display === "none") return;

  if (e.code === "ArrowUp" && snakeDirection.y !== 1) {
    snakeDirection = { x: 0, y: -1 };
  } else if (e.code === "ArrowDown" && snakeDirection.y !== -1) {
    snakeDirection = { x: 0, y: 1 };
  } else if (e.code === "ArrowLeft" && snakeDirection.x !== 1) {
    snakeDirection = { x: -1, y: 0 };
  } else if (e.code === "ArrowRight" && snakeDirection.x !== -1) {
    snakeDirection = { x: 1, y: 0 };
  }
}

// ‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£
function placeSnakeFood() {
  snakeFood.x = Math.floor(Math.random() * snakeCols);
  snakeFood.y = Math.floor(Math.random() * snakeRows);
}

// ‡∏à‡∏ö‡πÄ‡∏Å‡∏°
function endSnakeGame() {
  snakeIsGameOver = true;
  if (snakeLoopId) {
    clearInterval(snakeLoopId);
    snakeLoopId = null;
  }
  alert("Game Over! Final Score: " + snakeScore);
}

// ‡πÅ‡∏™‡∏î‡∏á / ‡∏ã‡πà‡∏≠‡∏ô Snake ‡∏ï‡∏≠‡∏ô‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡πÄ‡∏°‡∏ô‡∏π
function showSnakeGame() {
  const grid = document.getElementById("minigameGrid");
  const snakeContainer = document.getElementById("snake-container");
  if (!grid || !snakeContainer) return;

  grid.style.display = "none";
  snakeContainer.style.display = "block";

  initSnakeGame();
}

function hideSnakeGame() {
  const grid = document.getElementById("minigameGrid");
  const snakeContainer = document.getElementById("snake-container");
  if (!grid || !snakeContainer) return;

  snakeContainer.style.display = "none";
  grid.style.display = "grid";

  if (snakeLoopId) {
    clearInterval(snakeLoopId);
    snakeLoopId = null;
  }
}

// ‡∏õ‡∏∏‡πà‡∏°‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡πÄ‡∏Å‡∏°‡∏á‡∏π
document.getElementById("snake-back-button")?.addEventListener("click", hideSnakeGame);

</script>
 
</body>
</html>